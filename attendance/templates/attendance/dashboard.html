{% extends "base.html" %}
{% load static %}

{% block title %}Attendance Dashboard{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col">
            <h2><i class="fas fa-clock"></i> Attendance Dashboard</h2>
            <p class="text-muted">Track your attendance and working hours</p>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="text-muted mb-2">Employee Code</h5>
                    <h3>{{ profile.employee_code }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="text-muted mb-2">Department</h5>
                    <h3>{{ profile.department.name|default:"N/A" }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="text-muted mb-2">This Week Hours</h5>
                    <h3>{{ total_hours_week|floatformat:2 }}h</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card {% if is_clocked_in %}border-success{% endif %}">
                <div class="card-body text-center">
                    <h5 class="text-muted mb-2">Status</h5>
                    {% if is_clocked_in %}
                        <h3 class="text-success"><i class="fas fa-circle"></i> Clocked In</h3>
                    {% else %}
                        <h3 class="text-secondary"><i class="far fa-circle"></i> Clocked Out</h3>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Today's Record -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-calendar-day"></i> Today's Attendance</h5>
                </div>
                <div class="card-body">
                    {% if today_record %}
                        <div class="row">
                            <div class="col-md-4">
                                <strong>Clock In:</strong>
                                <p>{{ today_record.clock_in|date:"H:i:s" }}</p>
                                <small class="text-muted">Method: {{ today_record.get_clock_in_method_display }}</small>
                            </div>
                            <div class="col-md-4">
                                <strong>Clock Out:</strong>
                                {% if today_record.clock_out %}
                                    <p>{{ today_record.clock_out|date:"H:i:s" }}</p>
                                    <small class="text-muted">Method: {{ today_record.get_clock_out_method_display }}</small>
                                {% else %}
                                    <p class="text-warning">Still working...</p>
                                {% endif %}
                            </div>
                            <div class="col-md-4">
                                <strong>Total Hours:</strong>
                                <p>{{ today_record.total_hours|default:"N/A" }}h</p>
                            </div>
                        </div>
                        {% if today_record.notes %}
                            <div class="mt-3">
                                <strong>Notes:</strong>
                                <p>{{ today_record.notes }}</p>
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-info-circle fa-2x mb-2"></i>
                            <p>No attendance record for today yet.</p>
                            <p class="text-muted small">Please contact your administrator to clock in via the attendance system.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Week's Records -->
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-calendar-week"></i> This Week's Records</h5>
                    <a href="{% url 'attendance:records' %}" class="btn btn-light btn-sm">
                        <i class="fas fa-history"></i> View All Records
                    </a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Clock In</th>
                                    <th>Clock Out</th>
                                    <th>Total Hours</th>
                                    <th>Method</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record in week_records %}
                                <tr>
                                    <td>{{ record.clock_in|date:"Y-m-d (D)" }}</td>
                                    <td>{{ record.clock_in|date:"H:i:s" }}</td>
                                    <td>
                                        {% if record.clock_out %}
                                            {{ record.clock_out|date:"H:i:s" }}
                                        {% else %}
                                            <span class="badge bg-warning">Active</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if record.total_hours %}
                                            {{ record.total_hours|floatformat:2 }}h
                                        {% else %}
                                            <span class="text-muted">N/A</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <small>{{ record.get_clock_in_method_display }}</small>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center text-muted py-4">
                                        <i class="fas fa-inbox"></i> No records this week
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Info -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <h5><i class="fas fa-business-time"></i> Your Work Schedule</h5>
                    <p>
                        <strong>Start:</strong> {{ profile.work_schedule_start|default:"Not set" }}
                        &nbsp;&nbsp;|&nbsp;&nbsp;
                        <strong>End:</strong> {{ profile.work_schedule_end|default:"Not set" }}
                    </p>
                    <a href="{% url 'attendance:profile_setup' %}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-edit"></i> Edit Profile
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
