{% extends 'base.html' %}

{% block title %}Project Templates{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-layer-group"></i> Project Templates</h2>
        <a href="{% url 'project_management:template_create' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Create Template
        </a>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h3 class="text-primary mb-0">{{ template_data|length }}</h3>
                    <p class="text-muted mb-0">Available Templates</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h3 class="text-success mb-0">
                        {% for item in template_data %}{% if item.is_owner %}1{% endif %}{% endfor %}
                    </h3>
                    <p class="text-muted mb-0">My Templates</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h3 class="text-info mb-0">
                        {{ template_data|length }}
                    </h3>
                    <p class="text-muted mb-0">Public Templates</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h3 class="text-warning mb-0">
                        {% for item in template_data %}{{ item.usage_count|add:"0" }}{% endfor %}
                    </h3>
                    <p class="text-muted mb-0">Total Uses</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" id="filterForm" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Search</label>
                    <input type="text" class="form-control" name="search"
                           value="{{ filters.search }}" placeholder="Template name or description...">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Category</label>
                    <select class="form-control" name="category">
                        <option value="">All Categories</option>
                        {% for value, label in categories %}
                        <option value="{{ value }}" {% if filters.category == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary me-2">
                        <i class="fas fa-filter"></i> Apply Filters
                    </button>
                    <a href="{% url 'project_management:template_list' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-times"></i> Clear
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Template Cards -->
    {% if template_data %}
    <div class="row">
        {% for item in template_data %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100 template-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span class="badge badge-{{ item.template.category }} badge-pill">
                        {{ item.template.get_category_display }}
                    </span>
                    {% if item.template.is_public %}
                    <span class="badge badge-success">
                        <i class="fas fa-globe"></i> Public
                    </span>
                    {% else %}
                    <span class="badge badge-secondary">
                        <i class="fas fa-lock"></i> Private
                    </span>
                    {% endif %}
                </div>
                <div class="card-body">
                    <h5 class="card-title">
                        <a href="{% url 'project_management:template_detail' item.template.id %}">
                            {{ item.template.name }}
                        </a>
                    </h5>
                    <p class="card-text text-muted">
                        {{ item.template.description|truncatewords:20 }}
                    </p>

                    <div class="template-stats mt-3">
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="stat-number text-primary">{{ item.task_count }}</div>
                                <div class="stat-label">Tasks</div>
                            </div>
                            <div class="col-4">
                                <div class="stat-number text-info">{{ item.template.default_duration_days }}</div>
                                <div class="stat-label">Days</div>
                            </div>
                            <div class="col-4">
                                <div class="stat-number text-success">{{ item.usage_count }}</div>
                                <div class="stat-label">Uses</div>
                            </div>
                        </div>
                    </div>

                    <div class="template-meta mt-3">
                        <small class="text-muted">
                            <i class="fas fa-user"></i> {{ item.template.created_by.get_full_name }}
                            <br>
                            <i class="fas fa-calendar"></i> {{ item.template.created_at|date:"M d, Y" }}
                        </small>
                    </div>
                </div>
                <div class="card-footer bg-white">
                    <div class="btn-group w-100" role="group">
                        <a href="{% url 'project_management:template_detail' item.template.id %}"
                           class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye"></i> View
                        </a>
                        <a href="{% url 'project_management:project_from_template' item.template.id %}"
                           class="btn btn-sm btn-success">
                            <i class="fas fa-plus"></i> Use
                        </a>
                        {% if item.is_owner %}
                        <a href="{% url 'project_management:template_edit' item.template.id %}"
                           class="btn btn-sm btn-outline-warning">
                            <i class="fas fa-edit"></i>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card">
        <div class="card-body text-center py-5">
            <i class="fas fa-layer-group fa-4x text-muted mb-3"></i>
            <h4>No Templates Found</h4>
            <p class="text-muted">
                {% if filters.search or filters.category %}
                No templates match your filters. Try adjusting your search criteria.
                {% else %}
                No project templates available yet. Create your first template to get started!
                {% endif %}
            </p>
            <a href="{% url 'project_management:template_create' %}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Create First Template
            </a>
        </div>
    </div>
    {% endif %}
</div>

<style>
    .template-card {
        transition: transform 0.2s, box-shadow 0.2s;
        border: 1px solid #dee2e6;
    }

    .template-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .template-card .card-title a {
        color: #212529;
        text-decoration: none;
    }

    .template-card .card-title a:hover {
        color: #007bff;
        text-decoration: underline;
    }

    .template-stats .stat-number {
        font-size: 1.5rem;
        font-weight: bold;
    }

    .template-stats .stat-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        color: #6c757d;
    }

    .template-meta {
        border-top: 1px solid #dee2e6;
        padding-top: 10px;
    }

    .badge-software { background-color: #007bff; }
    .badge-construction { background-color: #fd7e14; }
    .badge-marketing { background-color: #e83e8c; }
    .badge-research { background-color: #6f42c1; }
    .badge-event { background-color: #20c997; }
    .badge-consulting { background-color: #17a2b8; }
    .badge-design { background-color: #d63384; }
    .badge-other { background-color: #6c757d; }
</style>

<script>
    // Auto-submit form on filter change
    document.querySelector('select[name="category"]').addEventListener('change', function() {
        document.getElementById('filterForm').submit();
    });

    // Debounced search
    let searchTimeout;
    document.querySelector('input[name="search"]').addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            document.getElementById('filterForm').submit();
        }, 500);
    });
</script>
{% endblock %}
